---
import BaseLayout from "@layouts/base-layout.astro";
import { siteConfig } from "@site-config";
import { getAllPosts } from "@utils/post";
import type { Post } from "@types";
import EtiquetteIcon from "@icons/etiquette.svg?raw";

export async function getStaticPaths() {
  const posts: Post[] = await getAllPosts(false, false);

  return posts.map((post: Post) => ({
    params: { slug: post.slug },
    props: { ...post },
  }));
}

const { title, publishDate, description, content, tags, featured, readTime } =
  Astro.props;
const formattedDate: string = new Date(publishDate).toLocaleString(
  siteConfig.locale,
  {
    dateStyle: "long",
  },
);
---

<BaseLayout
  title={`${title} Â· ${siteConfig.siteTitle}`}
  description={description}
>
  <header class="mb-8">
    <a href="/posts" class="inline-flex items-center hover:underline mb-4">
      &larr; Back to Posts
    </a>
  </header>

  <article class="prose prose-lg dark:prose-invert max-w-none">
    <header class="mb-8 not-prose">
      <h1 class="text-2xl font-bold secondary mb-1">{title}</h1>
      <div class="flex items-center gap-4 mb-4">
        <time datetime={publishDate} class="text-xs text-gray-400">
          {formattedDate}{readTime ? ` - ${readTime} min read` : ""}
        </time>
      </div>
      {
        tags && tags.length > 0 && (
          <div class="flex flex-wrap mb-6">
            <div class="inline-flex items-center h-6 w-6 pb-2 mr-2 text-gray-300">
              <Fragment set:html={EtiquetteIcon} />
            </div>
            {tags.map((tag: string, index: number) => (
              <>
                <a
                  href={`/tags/${tag}/`}
                  class="text-xs text-gray-300 underline hover:text-gray-400 transition-colors"
                >
                  #{tag}
                </a>
                {index < tags.length - 1 && (
                  <span class="text-xs text-gray-300 mr-1">,</span>
                )}
              </>
            ))}
          </div>
        )
      }
      <p class="text-lg text-gray-300 leading-relaxed">{description}</p>
    </header>

    <div class="prose-content">
      <slot />
    </div>

    {content && <div class="mt-8 prose-content" set:html={content} />}
  </article>
</BaseLayout>

<style>
  .prose-content {
    animation: fadeIn 0.5s ease-in-out;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
